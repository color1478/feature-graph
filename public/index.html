<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‹¨ê³¼ëŒ€í•™ë³„ ì°¸ì„ìœ¨</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* ì „ì²´ ìŠ¤íƒ€ì¼ */
        body { 
            font-family: "Arial", sans-serif;
            text-align: center;
            background-image: url("í•™ì´ë°°ê²½.png");
            background-repeat: no-repeat;
            background-size: cover;
            margin: 0;
            padding: 20px;
        }

        h1{
          color:#FFF;
        }

        /* ë„¤ë¹„ê²Œì´ì…˜ ìŠ¤íƒ€ì¼ */
        .nav {
            background: #000;
            padding: 15px;
            text-align: center;
        }

        .nav a {
            color: white;
            font-size: 18px;
            text-decoration: none;
            font-weight: bold;
        }

        /* ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ */
        .charts {
          display: grid;
          grid-template-columns: repeat(5, 1fr); /* ê·¸ëŒ€ë¡œ ìœ ì§€ */
          grid-template-rows: repeat(2, auto); /* 2í–‰ ì„¤ì • */
          gap: 20px;
          justify-content: center;
          align-items: start;
          max-width: 1800px;
          margin: 20px auto 0;
        }


        /* ê°œë³„ ì°¨íŠ¸ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .chart-card {
          background: #F7F7F7;
            opacity: 97%;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            text-align: center;
            max-width: 350px;
            height: 350px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .chart-card h3 {
            font-size: 25px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .chart-value {
            position: absolute;
            font-size: 18px;
            font-weight: bold;
            color: #333;
            top: 60%;
            transform: translateY(-30%);
        }

        canvas {
            width: 100% !important;
            height: auto !important;
            max-width: 280px;
            max-height: 280px;
        }
    </style>
</head>
<body>

    <div class="nav">
        <a href="input.html">ë°ì´í„° ì…ë ¥í•˜ê¸°</a>
    </div>

    <h1>ë‹¨ê³¼ëŒ€í•™ë³„ ì°¸ì„ìœ¨</h1>

    <div class="charts">
        <div class="chart-card"><h3>ê²½ì˜ëŒ€í•™</h3><canvas id="chart1"></canvas><div class="chart-value" id="value1"></div></div>
        <div class="chart-card"><h3>ê³µê³¼ëŒ€í•™</h3><canvas id="chart2"></canvas><div class="chart-value" id="value2"></div></div>
        <div class="chart-card"><h3>ì¸ê³µì§€ëŠ¥ìœµí•©ëŒ€í•™</h3><canvas id="chart3"></canvas><div class="chart-value" id="value3"></div></div>
        <div class="chart-card"><h3>ì¸ë¬¸ì‚¬íšŒê³¼í•™ëŒ€í•™</h3><canvas id="chart4"></canvas><div class="chart-value" id="value4"></div></div>
        <div class="chart-card">
          <h3>ì°¸ì„ì ì´ë²¤íŠ¸<br>ì‘ëª¨ QR</h3>
          <img src="qr.png" alt="" width="200px">
          <div class="chart-value"></div>
        </div>
        <div class="chart-card">
          <h3>ì°¸ì„ì ì´ë²¤íŠ¸ <br> ì‘ëª¨ QR</h3>
          <img src="qr.png" alt="" width="200px">
          <div class="chart-value"></div>
        </div>
        <div class="chart-card"><h3>ìì—°ê³¼í•™ëŒ€í•™</h3><canvas id="chart5"></canvas><div class="chart-value" id="value5"></div></div>
        <div class="chart-card"><h3>ì „ìì •ë³´ê³µê³¼ëŒ€í•™</h3><canvas id="chart6"></canvas><div class="chart-value" id="value6"></div></div>
        <div class="chart-card"><h3>ì •ì±…ë²•í•™ëŒ€í•™</h3><canvas id="chart7"></canvas><div class="chart-value" id="value7"></div></div>
        <div class="chart-card"><h3>ììœ¨ì „ê³µí•™ë¶€</h3><canvas id="chart8"></canvas><div class="chart-value" id="value8"></div></div>
    </div>

    <script>
        let charts = [];
        const maxValues = [100, 200, 150, 180, 250, 120, 300, 500]; // ê° ë‹¨ê³¼ëŒ€ ìµœëŒ€ê°’

        // ğŸ“Œ WebSocket ì—°ê²°
        let ws = new WebSocket("ws://localhost:3000");

        ws.onmessage = function (event) {
            const result = JSON.parse(event.data);
            updateCharts(result.data);
        };

        async function fetchData() {
            const response = await fetch("http://localhost:3000/data");
            const result = await response.json();
            updateCharts(result.data);
        }

        function updateCharts(data) {
            const ctxList = Array.from({ length: 8 }, (_, i) => document.getElementById(`chart${i+1}`).getContext('2d'));

            // ê¸°ì¡´ ì°¨íŠ¸ê°€ ìˆë‹¤ë©´ íŒŒê´´ í›„ ë‹¤ì‹œ ìƒì„±
            charts.forEach(chart => chart.destroy());
            charts = [];

            ctxList.forEach((ctx, i) => {
                charts.push(new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ["ì°¸ê°€", "ë¶ˆì°¸"],
                        datasets: [{
                            data: [data[i], 100 - data[i]],
                            backgroundColor: ["#98c2bf", "#e0e0e0"],
                        }]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                }));

                document.getElementById(`value${i+1}`).innerText = `${data[i].toFixed(2)}% \n (${Math.round((data[i] / 100) * maxValues[i])}ëª…)`;
            });
        }

        fetchData(); // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    </script>
</body>
</html>
